var senderosAPI = "http://200.85.158.85/plesk-site-preview/turapp.com/api/SenderosAPI";
var senderosResult = [];

$$(document).on('DOMContentLoaded', function(){
    //descomentar para hacer la llamada ajax real
    //esta llamada de ajax tiene que estar dentro de esta funcion onReady para que funcione
        $.ajax({
     url: senderosAPI,
     success: function(feed) {
      console.log("--------------")
     //getNoticias(feed);
     console.dir(feed);
      senderosResult = feed;
         loadSenderos();
     }
     });
    //showContenidos(noticiasResult)


    console.log("senderos");

});


function loadSenderos(){

    for(var i=0;i<senderosResult.Senderos.length;i++)
    {
          var tmp= '<div class="card demo-card-header-pic senderoCard" data-senderoid="'+senderosResult.Senderos[i].ID+'">'+
                        '<div class="card-header align-items-flex-end"></div>'+
                        '<div class="card-content card-content-padding">'+
                        '<p class="titulonoticia">'+senderosResult.Senderos[i].Nombre+'</p>'+
                        '<p class="date">Destacado</p>'+
                        '<p>'+senderosResult.Senderos[i].Descripcion+'</p>'+
                        '</div>'+
                    '</div>';

        $$("#senderosResultDiv").append(tmp);
    }

    $$(".senderoCard").click(function(){
        app.popup.open('.popup-senderos')
        senderoID = $(this).data().senderoid;
    });

}



function onPopUpOpen(){
    //seba trolo
    //el id del sendero llega como variable global, va cambiando seg√∫n el atributo data-senderoid del tag a
    console.log("El id del sendero es " + senderoID);

    var mapTemplate = '<div class="card">'+
                      '     <div class="card-header mapaheader">Mapa del sendero</div>'+
                      '     <div id ="mapid" class="card-content card-content-padding"></div>'+
                      '<div class="card-footer mapafooter">algunos detalles del mapa</div>';

    $$("#senderoContainer").append(mapTemplate);

    var mymap =  L.map('mapid').setView([-31.54754175668209, -68.67658624939143], 16);
    var x =  L.tileLayer('mapas/quebradaZonda/{z}/{x}/{y}.jpg',{    maxZoom: 18, minZoom:15  }).addTo(mymap);


    //Traer desde API por primera vez luego sqlite.
    var circuito = [[[-31.54754175668209,-68.67658624939143],
        [-31.54752087578837,-68.67721137779041],
        [-31.54756165990529,-68.67807537377321],
        [-31.54762024595478,-68.67896141975665],
        [-31.54769521904418,-68.67935436796623],
        [-31.5481457763246,-68.67967600104198],
        [-31.54867789899416,-68.68006744964301],
        [-31.54891782604345,-68.68027826717766],
        [-31.54929087338699,-68.68028566475998],
        [-31.54943112802506,-68.68039449809413],
        [-31.54960673124868,-68.68044840977609],
        [-31.54981738258312,-68.68044914821797],
        [-31.55005747540145,-68.68047789992092],
        [-31.5502973139764,-68.68060210091753],
        [-31.55046467892444,-68.68068640536966],
        [-31.55060936160432,-68.68061951327572],
        [-31.55072920198904,-68.68066425004471],
        [-31.55089642706624,-68.68073901743477],
        [-31.55108472212872,-68.68078679517063],
        [-31.55136313443945,-68.68072301647581],
        [-31.55164782737501,-68.68084361572548],
        [-31.55178716941649,-68.68102994184234],
        [-31.55190615139749,-68.68116949894093],
        [-31.55210480368713,-68.68127051636165],
        [-31.5521118337513,-68.68127251358108],
        [-31.55243533141555,-68.68146905868001],
        [-31.55254968803213,-68.68159633260648],
        [-31.55255607487054,-68.68159801373544],
        [-31.552701142358,-68.6815964212945],
        [-31.55287420224201,-68.68151905810329],
        [-31.55315628219156,-68.68153697525997],
        [-31.55337917118246,-68.68151140066946],
        [-31.55348786759716,-68.68150249327663],
        [-31.55359900990967,-68.68148913549102],
        [-31.55384941780131,-68.68154587518761],
        [-31.55408696853833,-68.68164686545373],
        [-31.55433511739349,-68.68196981024127],
        [-31.55440171610355,-68.6822685887835],
        [-31.55452510142213,-68.68245315464432],
        [-31.5547923944898,-68.68265092117859],
        [-31.5549721703956,-68.68277089488889],
        [-31.55511081896685,-68.6828408729464],
        [-31.5553668903621,-68.68293840672405],
        [-31.55565321681786,-68.682913059435],
        [-31.55580582361542,-68.68309351799796],
        [-31.55603420856755,-68.68329897861796],
        [-31.55623489075239,-68.68348073793507],
        [-31.55638103755869,-68.68369738885906],
        [-31.55648592800441,-68.68380460949895],
        [-31.556702142493,-68.68392415473701],
        [-31.55693405699525,-68.68413189496144],
        [-31.55713338843484,-68.68437124014118],
        [-31.55733824255346,-68.68446624589878],
        [-31.55776537896792,-68.68498943419937],
        [-31.55797226916041,-68.68496971642293],
        [-31.55821565552241,-68.68514360007447],
        [-31.5582672139255,-68.68527709375192],
        [-31.55835817169124,-68.68549541087246],
        [-31.55840669604674,-68.68563837305091],
        [-31.55846216148959,-68.68577974798305],
        [-31.55855492015817,-68.68583858085515],
        [-31.55859566079762,-68.68590680863866],
        [-31.55855779032514,-68.6861070603327],
        [-31.55844281322389,-68.68618289535094],
        [-31.55828742628838,-68.68627246757163],
        [-31.55816651378162,-68.68615696869404],
        [-31.55814136978916,-68.68622692099652],
        [-31.55823025308004,-68.68648321562966],
        [-31.55822282800473,-68.68669274197615],
        [-31.55821562651563,-68.6868211315285],
        [-31.55818903252458,-68.68708207269057],
        [-31.5580907995904,-68.68722567865788],
        [-31.55788378868652,-68.68726290498606],
        [-31.55775661545444,-68.6873948091866],
        [-31.55767818910373,-68.68741698294141],
        [-31.55778976202324,-68.68720439960383],
        [-31.55781385430989,-68.68704344462326],
        [-31.55795784558686,-68.68695473279162],
        [-31.55802758351327,-68.68691542015051],
        [-31.55801445665314,-68.68675984622159],
        [-31.55800748839898,-68.68655128369709],
        [-31.55780953262024,-68.68638844285738],
        [-31.55769162976402,-68.68629500993342],
        [-31.55756339402658,-68.68627132810732],
        [-31.55739906112376,-68.68624080522521],
        [-31.55728190013121,-68.68629791158649],
        [-31.55704038882734,-68.68633754776543],
        [-31.55679657681564,-68.68632434781064],
        [-31.55659931872101,-68.68616283720455],
        [-31.55645060579524,-68.68606245044967],
        [-31.55633251639889,-68.6860830991708],
        [-31.55614220060782,-68.68615733516816],
        [-31.55591352730842,-68.686207367435],
        [-31.55565274302296,-68.68622633881159],
        [-31.55522113006093,-68.68614045506638],
        [-31.55492192326661,-68.6860295908332],
        [-31.55483261525385,-68.68596852682519],
        [-31.55467069095938,-68.68575101850961],
        [-31.55446198667832,-68.68550461733386],
        [-31.55423796616146,-68.68506057524863],
        [-31.55423149237086,-68.68505155954226],
        [-31.55403826202193,-68.68482659451028],
        [-31.55396988448556,-68.68474710231537],
        [-31.55363364681968,-68.68480910369698],
        [-31.55349797248258,-68.68479166205898],
        [-31.55313369587813,-68.68471670035896],
        [-31.55300907206441,-68.68463062646497],
        [-31.55295493361088,-68.6846548664129],
        [-31.55279894234814,-68.68462437168137],
        [-31.5526972981036,-68.68457704384343],
        [-31.55257957017312,-68.68448944598013],
        [-31.55245248833875,-68.6843610083381],
        [-31.55235075990912,-68.68422235960956],
        [-31.55227177642867,-68.68412267136262],
        [-31.5521806314381,-68.68399064308855],
        [-31.55204117876401,-68.68376282074608],
        [-31.55190082275979,-68.68355980833758],
        [-31.55173748807051,-68.68334705228466],
        [-31.55159309939855,-68.68320485007888],
        [-31.55142223593779,-68.68316188362988],
        [-31.55118552303769,-68.68323803410772],
        [-31.55111698162689,-68.68325763712382],
        [-31.55102694658856,-68.68320875111368],
        [-31.55082526423405,-68.68305602374144],
        [-31.55063977568472,-68.68289736750171],
        [-31.55033912271951,-68.68269809483809],
        [-31.55004209351129,-68.68252543313007],
        [-31.54974562324379,-68.68251138412434],
        [-31.54941738487177,-68.68249129582971],
        [-31.54931648252916,-68.6824483579103],
        [-31.54907074754146,-68.68234555444543],
        [-31.54920909844853,-68.68208555577199],
        [-31.54922930269055,-68.6817256433681],
        [-31.54919716977567,-68.68145421601557],
        [-31.54889979237285,-68.6813223937765],
        [-31.54863299332957,-68.68102875834617],
        [-31.54835552999176,-68.68086946815274],
        [-31.54805590999492,-68.68084968038437],
        [-31.54776257124879,-68.68090820040827],
        [-31.54738960630909,-68.68091787555042],
        [-31.54727855977967,-68.6809373470752],
        [-31.54718892797187,-68.68071437466624],
        [-31.54696174152068,-68.68009386950114],
        [-31.5467873816425,-68.67947341106751],
        [-31.546784844722,-68.67900637642251],
        [-31.54674939328005,-68.67873862383149],
        [-31.54717343397915,-68.67698701435333],
        [-31.54737242594046,-68.67669977912284]]];



    var plArray = [];
    for(var i=0; i<circuito.length; i++) {
        plArray.push(L.polyline(circuito[i]).addTo(mymap));
    }

}

function onPopUpClose(){

    $$("#senderoContainer").empty();

}